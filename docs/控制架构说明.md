# CleanBot æ§åˆ¶æ¶æ„å®Œæ•´è¯´æ˜

## ğŸ“‹ ç›®å½•
1. [ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ](#ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ)
2. [æ•°æ®æµè¯¦è§£](#æ•°æ®æµè¯¦è§£)
3. [å„æ¨¡å—èŒè´£](#å„æ¨¡å—èŒè´£)
4. [å•ä½è½¬æ¢è§„åˆ™](#å•ä½è½¬æ¢è§„åˆ™)
5. [é…ç½®éªŒè¯](#é…ç½®éªŒè¯)
6. [è¯é¢˜åˆ—è¡¨](#è¯é¢˜åˆ—è¡¨)
7. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·å±‚ / å¯¼èˆªå±‚                              â”‚
â”‚                    å‘å¸ƒ /cmd_vel (Twistæ¶ˆæ¯)                         â”‚
â”‚                    linear.x (m/s), angular.z (rad/s)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   diff_drive_controller                              â”‚
â”‚  åŠŸèƒ½ï¼šå·®é€Ÿè¿åŠ¨å­¦é€†è§£ + é‡Œç¨‹è®¡èåˆ + é€Ÿåº¦é™åˆ¶                        â”‚
â”‚  è¾“å…¥ï¼š/cmd_vel (Twist)                                              â”‚
â”‚  è¾“å‡ºï¼šå…³èŠ‚é€Ÿåº¦å‘½ä»¤ (rad/s) â†’ hw_commands_velocity_[]               â”‚
â”‚  å‘å¸ƒï¼š/odom (é‡Œç¨‹è®¡), /tf (odomâ†’base_footprint)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç¡¬ä»¶æ¥å£ (CleanBotHardwareInterface)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  read() - 50Hz                                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ è®¢é˜… /joint_states (æ¥è‡ªUSBèŠ‚ç‚¹)                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ è§£æ: position (rad), velocity (rad/s)                    â”‚ â”‚
â”‚  â”‚  â””â”€ æ›´æ–°: hw_positions_[], hw_velocities_[]                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  write() - 50Hz                                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ è¯»å–: hw_commands_velocity_[] (rad/s)                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ è½¬æ¢: v (m/s) = Ï‰ (rad/s) Ã— r (0.032m)                    â”‚ â”‚
â”‚  â”‚  â””â”€ å‘å¸ƒ: /wheel_speed_cmd [left_speed, right_speed] (m/s)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USBé€šè®¯èŠ‚ç‚¹ (Python)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  è®¢é˜… /wheel_speed_cmd (Float32MultiArray)                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ [0]: left_wheel_speed (m/s)                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ [1]: right_wheel_speed (m/s)                               â”‚ â”‚
â”‚  â”‚  â””â”€ æ‰“åŒ…ä¸ºåè®®å¸§ MSG_ID=0x10ï¼Œå‘é€ç»™STM32                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æ¥æ”¶STM32æ•°æ®å¹¶å‘å¸ƒ                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ MSG_ID=0x21 (è½®å­æ•°æ®) â†’ /joint_states                     â”‚ â”‚
â”‚  â”‚  â”‚   â€¢ position: angle_deg â†’ rad                               â”‚ â”‚
â”‚  â”‚  â”‚   â€¢ velocity: speed_mps â†’ rad/s (v/r)                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ MSG_ID=0x20 (IMUæ•°æ®) â†’ /imu/data_raw                      â”‚ â”‚
â”‚  â”‚  â””â”€ MSG_ID=0x22 (ä¼ æ„Ÿå™¨) â†’ /sensors_status                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â†“ USB/ä¸²å£
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          STM32 å›ºä»¶                                  â”‚
â”‚  æ¥æ”¶ï¼šCONTROL_CMD (0x10)                                            â”‚
â”‚    - left_wheel_speed_mps (float32, m/s)                            â”‚
â”‚    - right_wheel_speed_mps (float32, m/s)                           â”‚
â”‚  å‘é€ï¼š                                                              â”‚
â”‚    - WHEEL (0x21): è§’åº¦(Â°) + é€Ÿåº¦(m/s), 200Hz                       â”‚
â”‚    - IMU (0x20): åŠ é€Ÿåº¦ + è§’é€Ÿåº¦ + å§¿æ€, 100Hz                      â”‚
â”‚    - SENSORS (0x22): ç¢°æ’/çº¢å¤–/æ•…éšœ, 20-50Hz                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ æ•°æ®æµè¯¦è§£

### 1ï¸âƒ£ å‘½ä»¤ä¸‹å‘æµç¨‹ï¼ˆç”¨æˆ· â†’ STM32ï¼‰

```
/cmd_vel (linear.x=0.2 m/s, angular.z=0.5 rad/s)
    â†“
diff_drive_controller å·®é€Ÿé€†è§£:
    v_left = v - Ï‰Ã—L/2 = 0.2 - 0.5Ã—0.2/2 = 0.15 m/s
    v_right = v + Ï‰Ã—L/2 = 0.2 + 0.5Ã—0.2/2 = 0.25 m/s
    è½¬æ¢ä¸ºè§’é€Ÿåº¦:
    Ï‰_left = v_left / r = 0.15 / 0.032 = 4.6875 rad/s
    Ï‰_right = v_right / r = 0.25 / 0.032 = 7.8125 rad/s
    â†“
hw_commands_velocity_[0] = 4.6875 rad/s  (left)
hw_commands_velocity_[1] = 7.8125 rad/s  (right)
    â†“
ç¡¬ä»¶æ¥å£ write() è½¬æ¢å›çº¿é€Ÿåº¦:
    left_speed = 4.6875 Ã— 0.032 = 0.15 m/s
    right_speed = 7.8125 Ã— 0.032 = 0.25 m/s
    â†“
/wheel_speed_cmd [0.15, 0.25]
    â†“
USBèŠ‚ç‚¹æ‰“åŒ…ä¸ºåè®®å¸§:
    MSG_ID = 0x10
    payload = struct.pack('<ff...', 0.15, 0.25, ...)
    â†“
STM32 ç”µæœºæ§åˆ¶å™¨æ‰§è¡Œ
```

### 2ï¸âƒ£ åé¦ˆä¸ŠæŠ¥æµç¨‹ï¼ˆSTM32 â†’ æ§åˆ¶å™¨ï¼‰

```
STM32 ç¼–ç å™¨/IMUé‡‡é›†
    â†“
USBé€šè®¯èŠ‚ç‚¹è§£æ:
    MSG_ID = 0x21 (WHEEL)
    left_angle_deg = 360.0Â°
    left_speed_mps = 0.15 m/s
    right_angle_deg = 720.0Â°
    right_speed_mps = 0.25 m/s
    â†“
è½¬æ¢å•ä½:
    position[0] = deg2rad(360.0) = 6.283 rad
    position[1] = deg2rad(720.0) = 12.566 rad
    velocity[0] = 0.15 / 0.032 = 4.6875 rad/s
    velocity[1] = 0.25 / 0.032 = 7.8125 rad/s
    â†“
å‘å¸ƒ /joint_states
    â†“
ç¡¬ä»¶æ¥å£ read() æ›´æ–°:
    hw_positions_[0] = 6.283 rad
    hw_positions_[1] = 12.566 rad
    hw_velocities_[0] = 4.6875 rad/s
    hw_velocities_[1] = 7.8125 rad/s
    â†“
diff_drive_controller è¯»å–çŠ¶æ€:
    - è®¡ç®—é‡Œç¨‹è®¡ (åŸºäºä½ç½®å˜åŒ–)
    - èåˆ IMU æ•°æ® (æ¥è‡ª /imu/data_raw)
    - å‘å¸ƒ /odom å’Œ /tf
```

---

## ğŸ”§ å„æ¨¡å—èŒè´£

### 1. **diff_drive_controller** (ROS2å®˜æ–¹æ§åˆ¶å™¨)

**èŒè´£ï¼š**
- âœ… è®¢é˜… `/cmd_vel`ï¼Œè¿›è¡Œå·®é€Ÿè¿åŠ¨å­¦é€†è§£
- âœ… å°† `(v, Ï‰)` è½¬æ¢ä¸º `(Ï‰_left, Ï‰_right)` å¹¶å†™å…¥ `hw_commands_velocity_[]`
- âœ… ä» `hw_positions_[]`, `hw_velocities_[]` è¯»å–å…³èŠ‚çŠ¶æ€
- âœ… è®¡ç®—é‡Œç¨‹è®¡å¹¶å‘å¸ƒ `/odom` å’Œ `/tf`
- âœ… èåˆ IMU æ•°æ®ï¼ˆé€šè¿‡ EKFï¼‰

**é…ç½®æ–‡ä»¶ï¼š** `cleanbot_controllers.yaml`

**å…³é”®å‚æ•°ï¼š**
```yaml
wheel_separation: 0.2     # è½®é—´è· (m)
wheel_radius: 0.032       # è½®åŠå¾„ (m)
update_rate: 50           # æ§åˆ¶é¢‘ç‡ (Hz)
```

---

### 2. **ç¡¬ä»¶æ¥å£** (CleanBotHardwareInterface)

**èŒè´£ï¼š**
- âœ… **read()**: è®¢é˜… `/joint_states`ï¼Œæ›´æ–° `hw_positions_[]` å’Œ `hw_velocities_[]`
- âœ… **write()**: è¯»å– `hw_commands_velocity_[]`ï¼Œè½¬æ¢ä¸º m/sï¼Œå‘å¸ƒåˆ° `/wheel_speed_cmd`
- âŒ **ä¸è´Ÿè´£**ï¼šå·®é€Ÿè¿åŠ¨å­¦è®¡ç®—ã€é‡Œç¨‹è®¡è®¡ç®—

**å•ä½è½¬æ¢ï¼š**
- **read**: æ— éœ€è½¬æ¢ï¼ˆUSBèŠ‚ç‚¹å·²è½¬æ¢ä¸º rad å’Œ rad/sï¼‰
- **write**: `v (m/s) = Ï‰ (rad/s) Ã— r (0.032m)`

**é…ç½®æ–‡ä»¶ï¼š** `cleanbot_real.ros2_control.xacro`

---

### 3. **USBé€šè®¯èŠ‚ç‚¹** (usb_communication_node.py)

**èŒè´£ï¼š**
- âœ… **ä¸‹è¡Œ**ï¼šè®¢é˜… `/wheel_speed_cmd`ï¼Œæ‰“åŒ…ä¸ºåè®®å¸§ï¼ˆ0x10ï¼‰ï¼Œå‘é€ç»™STM32
- âœ… **ä¸Šè¡Œ**ï¼šè§£æSTM32æ•°æ®ï¼Œå‘å¸ƒåˆ°ROSè¯é¢˜
  - 0x21 (WHEEL) â†’ `/joint_states` (è½¬æ¢å•ä½ï¼)
  - 0x20 (IMU) â†’ `/imu/data_raw`
  - 0x22 (SENSORS) â†’ `/sensors_status`
- âœ… é€šè®¯è´¨é‡ç›‘æ§ã€è‡ªåŠ¨é‡è¿

**å•ä½è½¬æ¢ï¼š**
- **è§’åº¦**ï¼š`rad = deg Ã— Ï€ / 180`
- **é€Ÿåº¦**ï¼š`rad/s = (m/s) / 0.032`

---

### 4. **STM32å›ºä»¶**

**èŒè´£ï¼š**
- âœ… æ¥æ”¶è½®é€Ÿå‘½ä»¤ï¼ˆm/sï¼‰ï¼Œæ§åˆ¶ç”µæœº
- âœ… é‡‡é›†ç¼–ç å™¨ï¼ˆè§’åº¦Â°ã€é€Ÿåº¦m/sï¼‰ã€IMUã€ä¼ æ„Ÿå™¨
- âœ… æŒ‰åè®®æ‰“åŒ…å¹¶å‘é€

**åè®®è§„èŒƒï¼š** è§ `STM32 ç«¯ USB é€šè®¯åè®®å®ç°ä»»åŠ¡æ–‡æ¡£.md`

---

## ğŸ“ å•ä½è½¬æ¢è§„åˆ™

### å…³é”®å‚æ•°
- **è½®åŠå¾„ `r`**: `0.032 m`
- **è½®é—´è· `L`**: `0.2 m`

### è½¬æ¢å…¬å¼

| è½¬æ¢æ–¹å‘ | å…¬å¼ | ç¤ºä¾‹ |
|---------|------|------|
| çº¿é€Ÿåº¦ â†’ è§’é€Ÿåº¦ | `Ï‰ = v / r` | `0.16 m/s Ã· 0.032 m = 5 rad/s` |
| è§’é€Ÿåº¦ â†’ çº¿é€Ÿåº¦ | `v = Ï‰ Ã— r` | `5 rad/s Ã— 0.032 m = 0.16 m/s` |
| è§’åº¦ â†’ å¼§åº¦ | `rad = deg Ã— Ï€ / 180` | `360Â° Ã— Ï€ / 180 = 6.283 rad` |
| å¼§åº¦ â†’ è§’åº¦ | `deg = rad Ã— 180 / Ï€` | `6.283 rad Ã— 180 / Ï€ = 360Â°` |

### å·®é€Ÿè¿åŠ¨å­¦

**æ­£è§£ï¼ˆè½®é€Ÿ â†’ æœºå™¨äººé€Ÿåº¦ï¼‰ï¼š**
```
v = (v_left + v_right) / 2
Ï‰ = (v_right - v_left) / L
```

**é€†è§£ï¼ˆæœºå™¨äººé€Ÿåº¦ â†’ è½®é€Ÿï¼‰ï¼š**
```
v_left = v - Ï‰ Ã— L / 2
v_right = v + Ï‰ Ã— L / 2
```

---

## âœ… é…ç½®éªŒè¯

### 1. URDFé…ç½® (`cleanbot_real.urdf.xacro`)

```xml
<!-- å…³èŠ‚åç§° -->
<joint name="left_wheel_joint" type="continuous">
  <origin xyz="0 0.1 -0.05"/>  <!-- y=0.1 â†’ è½®é—´è·=0.2 âœ“ -->
</joint>

<joint name="right_wheel_joint" type="continuous">
  <origin xyz="0 -0.1 -0.05"/>  <!-- y=-0.1 â†’ è½®é—´è·=0.2 âœ“ -->
</joint>

<!-- è½®å­åŠå¾„ -->
<cylinder radius="0.032" length="0.015"/>  <!-- âœ“ -->
```

### 2. ros2_controlé…ç½® (`cleanbot_real.ros2_control.xacro`)

```xml
<hardware>
  <plugin>cleanbot_control/CleanBotHardwareInterface</plugin>
  <param name="wheel_radius">0.032</param>        <!-- âœ“ -->
  <param name="wheel_separation">0.2</param>      <!-- âœ“ -->
</hardware>

<joint name="left_wheel_joint">                   <!-- âœ“ -->
  <command_interface name="velocity"/>            <!-- âœ“ -->
  <state_interface name="position"/>              <!-- âœ“ -->
  <state_interface name="velocity"/>              <!-- âœ“ -->
</joint>

<joint name="right_wheel_joint">                  <!-- âœ“ -->
  <!-- åŒä¸Š -->
</joint>
```

### 3. æ§åˆ¶å™¨é…ç½® (`cleanbot_controllers.yaml`)

```yaml
diff_drive_controller:
  ros__parameters:
    left_wheel_names: ["left_wheel_joint"]        # âœ“
    right_wheel_names: ["right_wheel_joint"]      # âœ“
    wheel_separation: 0.2                         # âœ“
    wheel_radius: 0.032                           # âœ“
    update_rate: 50.0                             # âœ“
```

### 4. USBèŠ‚ç‚¹é…ç½® (ç¡¬ç¼–ç )

```python
# usb_communication_node.py ç¬¬537è¡Œ
wheel_radius = 0.032  # m  â† âœ“ ç¡®ä¿ä¸€è‡´
```

**âœ… æ‰€æœ‰é…ç½®ä¸€è‡´ï¼**

---

## ğŸ“¡ è¯é¢˜åˆ—è¡¨

### è¾“å…¥è¯é¢˜ï¼ˆè®¢é˜…ï¼‰

| è¯é¢˜ | æ¶ˆæ¯ç±»å‹ | å‘å¸ƒè€… | è®¢é˜…è€… | é¢‘ç‡ | è¯´æ˜ |
|------|---------|--------|--------|------|------|
| `/cmd_vel` | `Twist` | ç”¨æˆ·/å¯¼èˆª | `diff_drive_controller` | å¯å˜ | æœºå™¨äººé€Ÿåº¦å‘½ä»¤ |
| `/joint_states` | `JointState` | USBèŠ‚ç‚¹ | ç¡¬ä»¶æ¥å£ | 200Hz | å…³èŠ‚çŠ¶æ€åé¦ˆ |
| `/wheel_speed_cmd` | `Float32MultiArray` | ç¡¬ä»¶æ¥å£ | USBèŠ‚ç‚¹ | 50Hz | è½®é€Ÿå‘½ä»¤(m/s) |
| `/imu/data_raw` | `Imu` | USBèŠ‚ç‚¹ | EKF/æ§åˆ¶å™¨ | 100Hz | IMUåŸå§‹æ•°æ® |

### è¾“å‡ºè¯é¢˜ï¼ˆå‘å¸ƒï¼‰

| è¯é¢˜ | æ¶ˆæ¯ç±»å‹ | å‘å¸ƒè€… | è®¢é˜…è€… | é¢‘ç‡ | è¯´æ˜ |
|------|---------|--------|--------|------|------|
| `/odom` | `Odometry` | `diff_drive_controller` | å¯¼èˆª/SLAM | 50Hz | é‡Œç¨‹è®¡æ•°æ® |
| `/tf` | `TFMessage` | `diff_drive_controller` | å…¨å±€ | 50Hz | odomâ†’base_footprint |
| `/sensors_status` | `UInt8MultiArray` | USBèŠ‚ç‚¹ | å®‰å…¨/å¯¼èˆª | 50Hz | ä¼ æ„Ÿå™¨çŠ¶æ€ |
| `/usb_connected` | `Bool` | USBèŠ‚ç‚¹ | ç›‘æ§ | 1Hz | USBè¿æ¥çŠ¶æ€ |
| `/comm_quality` | `String` | USBèŠ‚ç‚¹ | ç›‘æ§ | 1Hz | é€šè®¯è´¨é‡ç»Ÿè®¡ |

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæœºå™¨äººä¸åŠ¨

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. æ£€æŸ¥ /cmd_vel æ˜¯å¦æœ‰æ•°æ®
ros2 topic echo /cmd_vel

# 2. æ£€æŸ¥æ§åˆ¶å™¨æ˜¯å¦è¿è¡Œ
ros2 control list_controllers

# 3. æ£€æŸ¥ /wheel_speed_cmd æ˜¯å¦å‘å¸ƒ
ros2 topic echo /wheel_speed_cmd

# 4. æ£€æŸ¥USBè¿æ¥
ros2 topic echo /usb_connected

# 5. æ£€æŸ¥STM32æ˜¯å¦æ”¶åˆ°å‘½ä»¤ï¼ˆæŸ¥çœ‹USBèŠ‚ç‚¹æ—¥å¿—ï¼‰
ros2 node list
```

### é—®é¢˜2ï¼šé‡Œç¨‹è®¡æ¼‚ç§»ä¸¥é‡

**å¯èƒ½åŸå› ï¼š**
- è½®å­åŠå¾„é…ç½®é”™è¯¯ â†’ æ£€æŸ¥æ‰€æœ‰é…ç½®æ–‡ä»¶
- ç¼–ç å™¨æ•°æ®ä¸¢åŒ… â†’ æŸ¥çœ‹ `/comm_quality`
- IMUæ•°æ®æœªèåˆ â†’ æ£€æŸ¥ EKF é…ç½®

### é—®é¢˜3ï¼šé€Ÿåº¦å“åº”ä¸å¯¹

**æ£€æŸ¥æ¸…å•ï¼š**
- [ ] æ‰€æœ‰é…ç½®æ–‡ä»¶ä¸­çš„ `wheel_radius` å’Œ `wheel_separation` ä¸€è‡´
- [ ] USBèŠ‚ç‚¹çš„å•ä½è½¬æ¢æ­£ç¡®ï¼ˆç¬¬537è¡Œï¼‰
- [ ] STM32å›ºä»¶ä½¿ç”¨æ­£ç¡®çš„å•ä½ï¼ˆm/sï¼‰

### é—®é¢˜4ï¼šç¼–è¯‘é”™è¯¯

```bash
# æ¸…ç†å¹¶é‡æ–°ç¼–è¯‘
cd /home/xiaoming/æ¡Œé¢/MOON/Electronic/CleanBot_ws
rm -rf build/ install/ log/
colcon build --packages-select cleanbot_control
source install/setup.bash
```

---

## ğŸš€ å¯åŠ¨ç³»ç»Ÿ

### å®Œæ•´å¯åŠ¨
```bash
cd /home/xiaoming/æ¡Œé¢/MOON/Electronic/CleanBot_ws
source install/setup.bash

# å¯åŠ¨ä¸»ç³»ç»Ÿ
ros2 launch cleanbot_control cleanbot.launch.py
```

### åˆ†æ­¥å¯åŠ¨ï¼ˆè°ƒè¯•ç”¨ï¼‰
```bash
# 1. USBé€šè®¯èŠ‚ç‚¹
ros2 run cleanbot_control usb_communication_node.py

# 2. æ§åˆ¶å™¨ç®¡ç†å™¨
ros2 launch cleanbot_control cleanbot.launch.py

# 3. å‘é€æµ‹è¯•å‘½ä»¤
ros2 topic pub /cmd_vel geometry_msgs/msg/Twist "{linear: {x: 0.1}, angular: {z: 0.0}}"
```

---

## ğŸ“ æ€»ç»“

### âœ… æ­£ç¡®çš„æ¶æ„ç‰¹ç‚¹
1. **æ— å¾ªç¯ä¾èµ–**ï¼š`/cmd_vel` åªè¢« `diff_drive_controller` è®¢é˜…
2. **æ¸…æ™°çš„å•ä½è½¬æ¢**ï¼šæ¯ä¸ªæ¨¡å—åªè´Ÿè´£è‡ªå·±çš„è½¬æ¢
3. **ä¸“ç”¨è¯é¢˜é€šä¿¡**ï¼š`/wheel_speed_cmd` ç”¨äºç¡¬ä»¶æ¥å£â†’USBèŠ‚ç‚¹
4. **ç»Ÿä¸€çš„å‚æ•°é…ç½®**ï¼šè½®å­åŠå¾„ã€è½®é—´è·åœ¨æ‰€æœ‰é…ç½®ä¸­ä¸€è‡´

### ğŸ¯ å…³é”®ç‚¹
- **æ§åˆ¶å™¨è´Ÿè´£è¿åŠ¨å­¦**ï¼šdiff_drive_controller å®Œæˆæ‰€æœ‰å·®é€Ÿè¿åŠ¨å­¦è®¡ç®—
- **ç¡¬ä»¶æ¥å£è´Ÿè´£å•ä½è½¬æ¢**ï¼šrad/s â†” m/s
- **USBèŠ‚ç‚¹è´Ÿè´£åè®®**ï¼šROSæ¶ˆæ¯ â†” ä¸²å£åè®®å¸§
- **STM32è´Ÿè´£æ‰§è¡Œ**ï¼šæ¥æ”¶ m/sï¼Œåé¦ˆ m/s å’Œè§’åº¦Â°

---

**æœ€åæ›´æ–°ï¼š** 2025-11-28  
**ç»´æŠ¤è€…ï¼š** CleanBot Team

