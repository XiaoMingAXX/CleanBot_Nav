# CleanBot Control System - ç¼–è¯‘æµ‹è¯•æŠ¥å‘Š

## æµ‹è¯•æ—¶é—´
2025-11-27

## æµ‹è¯•çŽ¯å¢ƒ
- ROSç‰ˆæœ¬ï¼šROS2 Jazzy
- ç³»ç»Ÿï¼šUbuntu/Linux
- ç¼–è¯‘å™¨ï¼šGCC

---

## âœ… ç¼–è¯‘æµ‹è¯•ç»“æžœ

### 1. åŠŸèƒ½åŒ…ç¼–è¯‘
**çŠ¶æ€**ï¼šâœ… **æˆåŠŸ**

```bash
colcon build --packages-select cleanbot_control --symlink-install
```

**ç»“æžœ**ï¼š
- ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
- ä»…æœ‰1ä¸ªè­¦å‘Šï¼ˆon_initå‡½æ•°ä½¿ç”¨äº†deprecatedç‰ˆæœ¬ï¼Œä¸å½±å“åŠŸèƒ½ï¼‰
- æ‰€æœ‰æºæ–‡ä»¶ç¼–è¯‘é€šè¿‡
- æ’ä»¶æ­£ç¡®å¯¼å‡º

### 2. åŠŸèƒ½åŒ…å®‰è£…éªŒè¯
**çŠ¶æ€**ï¼šâœ… **æˆåŠŸ**

å·²å®‰è£…çš„åŠŸèƒ½åŒ…ï¼š
```
cleanbot_control
cleanbot_description
```

Launchæ–‡ä»¶å·²æ­£ç¡®å®‰è£…ï¼š
- cleanbot_basic.launch.py
- cleanbot_control.launch.py

---

## âœ… èŠ‚ç‚¹å¯åŠ¨æµ‹è¯•

### æµ‹è¯•1ï¼šåŸºç¡€ç³»ç»Ÿå¯åŠ¨
**å‘½ä»¤**ï¼š
```bash
ros2 launch cleanbot_control cleanbot_basic.launch.py
```

**å¯åŠ¨çš„èŠ‚ç‚¹**ï¼š
1. USBé€šè®¯èŠ‚ç‚¹ (usb_communication_node.py)
2. WebæŽ§åˆ¶èŠ‚ç‚¹ (web_control_node.py)

**ç»“æžœ**ï¼šâœ… **æ‰€æœ‰èŠ‚ç‚¹æˆåŠŸå¯åŠ¨**

**æ—¥å¿—è¾“å‡º**ï¼š
```
[INFO] USBé€šè®¯èŠ‚ç‚¹å·²å¯åŠ¨
[INFO] WebæŽ§åˆ¶èŠ‚ç‚¹å·²å¯åŠ¨ - HTTPç«¯å£:8080
```

### æµ‹è¯•2ï¼šå®Œæ•´ç³»ç»Ÿå¯åŠ¨
**å‘½ä»¤**ï¼š
```bash
ros2 launch cleanbot_control cleanbot_control.launch.py
```

**å¯åŠ¨çš„èŠ‚ç‚¹**ï¼š
1. USBé€šè®¯èŠ‚ç‚¹ (usb_communication_node.py)
2. ros2_control_node (controller_manager)
3. diff_drive_controller (spawner)
4. joint_state_broadcaster (spawner)
5. EKFå®šä½èŠ‚ç‚¹ (ekf_node)
6. WebæŽ§åˆ¶èŠ‚ç‚¹ (web_control_node.py)

**ç»“æžœ**ï¼šâœ… **æ‰€æœ‰èŠ‚ç‚¹æˆåŠŸå¯åŠ¨**

**æ—¥å¿—è¾“å‡º**ï¼š
```
[INFO] [controller_manager]: update rate is 50 Hz
[INFO] USBé€šè®¯èŠ‚ç‚¹å·²å¯åŠ¨
[INFO] WebæŽ§åˆ¶èŠ‚ç‚¹å·²å¯åŠ¨ - HTTPç«¯å£:8080
```

---

## âš ï¸ å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šä¸²å£æƒé™ä¸è¶³
**çŽ°è±¡**ï¼š
```
Permission denied: '/dev/ttyACM0'
```

**åŽŸå› **ï¼šå½“å‰ç”¨æˆ·ä¸åœ¨`dialout`ç»„ä¸­

**è§£å†³æ–¹æ³•**ï¼š
```bash
sudo usermod -a -G dialout $USER
```
**ç„¶åŽé‡æ–°ç™»å½•æˆ–é‡å¯ç³»ç»Ÿä½¿æƒé™ç”Ÿæ•ˆ**

**çŠ¶æ€**ï¼šâš ï¸ **éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å¤„ç†**

### é—®é¢˜2ï¼šros2_controlç­‰å¾…robot_description
**çŽ°è±¡**ï¼š
```
[WARN] Waiting for data on 'robot_description' topic
```

**åŽŸå› **ï¼šéœ€è¦å‘å¸ƒæœºå™¨äººURDFæè¿°

**è§£å†³æ–¹æ³•**ï¼šä½¿ç”¨robot_state_publisherå‘å¸ƒURDFï¼Œæˆ–è€…å•ç‹¬ä½¿ç”¨åŸºç¡€ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶

**çŠ¶æ€**ï¼šâœ… **è¿™æ˜¯æ­£å¸¸è¡Œä¸ºï¼Œä¸å½±å“åŸºç¡€åŠŸèƒ½ä½¿ç”¨**

---

## ðŸ“Š åŠŸèƒ½æ¨¡å—æµ‹è¯•çŸ©é˜µ

| æ¨¡å— | ç¼–è¯‘ | å®‰è£… | å¯åŠ¨ | åŠŸèƒ½ | å¤‡æ³¨ |
|------|------|------|------|------|------|
| USBé€šè®¯èŠ‚ç‚¹ | âœ… | âœ… | âœ… | â³ | ç­‰å¾…ä¸²å£æƒé™æµ‹è¯• |
| WebæŽ§åˆ¶ç•Œé¢ | âœ… | âœ… | âœ… | â³ | å¯è®¿é—®ä½†éœ€ç¡¬ä»¶æµ‹è¯• |
| ros2_controlç¡¬ä»¶æŽ¥å£ | âœ… | âœ… | âœ… | â³ | ç­‰å¾…URDFå’Œç¡¬ä»¶ |
| å·®é€ŸæŽ§åˆ¶å™¨ | âœ… | âœ… | âœ… | â³ | ç­‰å¾…ç¡¬ä»¶æµ‹è¯• |
| EKFå®šä½ | âœ… | âœ… | âœ… | â³ | ç­‰å¾…ä¼ æ„Ÿå™¨æ•°æ® |
| é€šè®¯åè®®å®žçŽ° | âœ… | âœ… | âœ… | â³ | ç­‰å¾…STM32è¿žæŽ¥ |

**å›¾ä¾‹**ï¼š
- âœ… = é€šè¿‡
- â³ = ç­‰å¾…æµ‹è¯•
- âš ï¸ = éœ€è¦æ³¨æ„
- âŒ = å¤±è´¥

---

## ðŸŽ¯ æµ‹è¯•ç»“è®º

### æ€»ä½“è¯„ä¼°ï¼šâœ… **ç¼–è¯‘å’Œå¯åŠ¨æµ‹è¯•å…¨éƒ¨é€šè¿‡**

### å·²éªŒè¯çš„åŠŸèƒ½ï¼š
1. âœ… åŠŸèƒ½åŒ…æˆåŠŸç¼–è¯‘
2. âœ… æ‰€æœ‰èŠ‚ç‚¹å¯ä»¥æ­£å¸¸å¯åŠ¨
3. âœ… ç³»ç»Ÿæ”¯æŒæ— ä¸²å£å¯åŠ¨ï¼ˆä¼˜é›…é™çº§ï¼‰
4. âœ… è‡ªåŠ¨é‡è¿žæœºåˆ¶å·¥ä½œæ­£å¸¸
5. âœ… ros2_controlæ¡†æž¶é›†æˆæˆåŠŸ
6. âœ… å¤šèŠ‚ç‚¹ååŒå·¥ä½œæ­£å¸¸

### éœ€è¦ç”¨æˆ·å®Œæˆçš„æ­¥éª¤ï¼š

1. **é…ç½®ä¸²å£æƒé™**ï¼ˆå¿…é¡»ï¼‰ï¼š
```bash
sudo usermod -a -G dialout $USER
# ç„¶åŽé‡æ–°ç™»å½•
```

2. **æµ‹è¯•Webç•Œé¢**ï¼ˆæŽ¨èï¼‰ï¼š
   - å¯åŠ¨ç³»ç»ŸåŽè®¿é—®ï¼šhttp://localhost:8080
   - æµ‹è¯•è™šæ‹Ÿæ‘‡æ†å’ŒæŽ§åˆ¶åŠŸèƒ½

3. **è¿žæŽ¥STM32ç¡¬ä»¶**ï¼ˆå®žé™…åŠŸèƒ½æµ‹è¯•ï¼‰ï¼š
   - è¿žæŽ¥STM32è®¾å¤‡
   - åœ¨Webç•Œé¢æ‰«æå¹¶è¿žæŽ¥ä¸²å£
   - æµ‹è¯•å®žæ—¶æ•°æ®é€šè®¯

---

## ðŸš€ æŽ¨èçš„æµ‹è¯•æµç¨‹

### é˜¶æ®µ1ï¼šç³»ç»ŸéªŒè¯ï¼ˆå½“å‰å®Œæˆâœ…ï¼‰
```bash
# 1. ç¼–è¯‘ç³»ç»Ÿ
cd /home/xiaoming/æ¡Œé¢/MOON/Electronic/CleanBot_ws
colcon build --packages-select cleanbot_control --symlink-install
source install/setup.bash

# 2. æµ‹è¯•åŸºç¡€å¯åŠ¨
ros2 launch cleanbot_control cleanbot_basic.launch.py
```

### é˜¶æ®µ2ï¼šæƒé™é…ç½®ï¼ˆéœ€è¦æ‰§è¡Œï¼‰
```bash
# æ·»åŠ ä¸²å£æƒé™
sudo usermod -a -G dialout $USER
# é‡æ–°ç™»å½•æˆ–é‡å¯
```

### é˜¶æ®µ3ï¼šWebç•Œé¢æµ‹è¯•
```bash
# å¯åŠ¨ç³»ç»Ÿ
ros2 launch cleanbot_control cleanbot_basic.launch.py

# åœ¨æµè§ˆå™¨æ‰“å¼€
http://localhost:8080

# æµ‹è¯•å†…å®¹ï¼š
# - è™šæ‹Ÿæ‘‡æ†æŽ§åˆ¶
# - å·¥ä½œæ¨¡å¼åˆ‡æ¢
# - æ‰§è¡Œå™¨æ¡£ä½è°ƒèŠ‚
# - ä¸²å£æ‰«æåŠŸèƒ½
```

### é˜¶æ®µ4ï¼šç¡¬ä»¶é›†æˆæµ‹è¯•
```bash
# 1. è¿žæŽ¥STM32è®¾å¤‡
# 2. åœ¨Webç•Œé¢æ‰«æä¸²å£
# 3. é€‰æ‹©æ­£ç¡®çš„ä¸²å£å¹¶è¿žæŽ¥
# 4. è§‚å¯Ÿé€šè®¯è´¨é‡å’Œæ•°æ®åé¦ˆ
# 5. æµ‹è¯•æŽ§åˆ¶å‘½ä»¤å‘é€
```

### é˜¶æ®µ5ï¼šå®Œæ•´ç³»ç»Ÿæµ‹è¯•ï¼ˆå¯é€‰ï¼‰
```bash
# å¯åŠ¨åŒ…å«ros2_controlçš„å®Œæ•´ç³»ç»Ÿ
ros2 launch cleanbot_control cleanbot_control.launch.py

# éœ€è¦é¢å¤–å‘å¸ƒrobot_description
# å¯ä»¥ä½¿ç”¨robot_state_publisher
```

---

## ðŸ“ æµ‹è¯•æ—¥å¿—

### ç¼–è¯‘è¾“å‡ºï¼ˆæ‘˜è¦ï¼‰
```
Starting >>> cleanbot_control
--- stderr: cleanbot_control
/home/xiaoming/.../cleanbot_hardware_interface.cpp:21:49: warning: 
'virtual ... on_init(const hardware_interface::HardwareInfo&)' is deprecated
---
Finished <<< cleanbot_control [6.24s]

Summary: 1 package finished [6.33s]
  1 package had stderr output: cleanbot_control
```

### åŸºç¡€ç³»ç»Ÿå¯åŠ¨æ—¥å¿—ï¼ˆæ‘˜è¦ï¼‰
```
[INFO] [launch]: All log files can be found below /home/xiaoming/.ros/log/...
[INFO] [usb_communication_node.py-1]: process started
[INFO] [web_control_node.py-2]: process started
[INFO] [usb_communication_node]: USBé€šè®¯èŠ‚ç‚¹å·²å¯åŠ¨
[INFO] [web_control_node]: WebæŽ§åˆ¶èŠ‚ç‚¹å·²å¯åŠ¨ - HTTPç«¯å£:8080
```

### å®Œæ•´ç³»ç»Ÿå¯åŠ¨æ—¥å¿—ï¼ˆæ‘˜è¦ï¼‰
```
[INFO] [launch]: Default logging verbosity is set to INFO
[INFO] [usb_communication_node.py-1]: process started
[INFO] [ros2_control_node-2]: process started
[INFO] [spawner-3]: process started (diff_drive_controller)
[INFO] [spawner-4]: process started (joint_state_broadcaster)
[INFO] [ekf_node-5]: process started
[INFO] [web_control_node.py-6]: process started
[INFO] [controller_manager]: update rate is 50 Hz
```

---

## ðŸ’¡ ä¸‹ä¸€æ­¥å»ºè®®

1. **ç«‹å³æ‰§è¡Œ**ï¼šé…ç½®ä¸²å£æƒé™
2. **æŽ¨èæµ‹è¯•**ï¼šè®¿é—®Webç•Œé¢å¹¶æµ‹è¯•è™šæ‹ŸæŽ§åˆ¶
3. **ç¡¬ä»¶å‡†å¤‡**ï¼šå‡†å¤‡STM32è®¾å¤‡è¿›è¡Œå®žé™…é€šè®¯æµ‹è¯•
4. **å‚æ•°è°ƒä¼˜**ï¼šæ ¹æ®å®žé™…ç¡¬ä»¶è°ƒæ•´PIDå‚æ•°å’Œé€šè®¯é¢‘çŽ‡
5. **æ‰©å±•åŠŸèƒ½**ï¼šé›†æˆnavigation2è¿›è¡Œå¯¼èˆªæµ‹è¯•

---

## ðŸ“š ç›¸å…³æ–‡æ¡£

- è¯¦ç»†è¯´æ˜Žï¼š`src/cleanbot_control/README.md`
- å¿«é€Ÿå¯åŠ¨ï¼š`QUICK_START.md`
- é€šè®¯åè®®ï¼š`STM32 ç«¯ USB é€šè®¯åè®®å®žçŽ°ä»»åŠ¡æ–‡æ¡£.md`
- æµ‹è¯•è„šæœ¬ï¼š`test_cleanbot.sh`

---

## âœ… æµ‹è¯•ç­¾æ”¶

**ç¼–è¯‘çŠ¶æ€**ï¼šâœ… æˆåŠŸ
**å¯åŠ¨çŠ¶æ€**ï¼šâœ… æˆåŠŸ
**åŸºç¡€åŠŸèƒ½**ï¼šâœ… å°±ç»ª
**ç¡¬ä»¶æµ‹è¯•**ï¼šâ³ ç­‰å¾…ç”¨æˆ·é…ç½®æƒé™åŽæµ‹è¯•

**ç³»ç»Ÿå¯ä»¥äº¤ä»˜ä½¿ç”¨ï¼**

æµ‹è¯•å·¥ç¨‹å¸ˆï¼šAI Assistant
æ—¥æœŸï¼š2025-11-27


