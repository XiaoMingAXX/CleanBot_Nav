# CleanBot å¯åŠ¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. ç¼–è¯‘ï¼ˆé¦–æ¬¡æˆ–ä»£ç ä¿®æ”¹åï¼‰
```bash
cd /home/xiaoming/æ¡Œé¢/MOON/Electronic/CleanBot_ws
colcon build --packages-select cleanbot_control --symlink-install
```

### 2. å¯åŠ¨å®Œæ•´ç³»ç»Ÿ
```bash
cd /home/xiaoming/æ¡Œé¢/MOON/Electronic/CleanBot_ws
source install/setup.bash
ros2 launch cleanbot_control cleanbot.launch.py
```

### 3. è®¿é—®Webæ§åˆ¶é¢æ¿
æµè§ˆå™¨æ‰“å¼€ï¼š**http://localhost:8080**

---

## ğŸ“¦ ç³»ç»ŸåŒ…å«çš„èŠ‚ç‚¹

### å¯åŠ¨é¡ºåºï¼ˆè‡ªåŠ¨ï¼‰

1. **0ç§’å¯åŠ¨**
   - `robot_state_publisher` - å‘å¸ƒæœºå™¨äººURDFå’ŒTFæ ‘
   - `usb_communication_node` - USBä¸²å£é€šè®¯
   - `web_control_node` - Webæ§åˆ¶æœåŠ¡å™¨

2. **2ç§’åå¯åŠ¨**
   - `controller_manager` - ros2_controlç®¡ç†å™¨
   - åŠ è½½ `CleanBotHardwareInterface` ç¡¬ä»¶æ¥å£

3. **4ç§’åå¯åŠ¨**
   - `diff_drive_controller` - å·®é€Ÿé©±åŠ¨æ§åˆ¶å™¨
   - `joint_state_broadcaster` - å…³èŠ‚çŠ¶æ€å¹¿æ’­å™¨

4. **5ç§’åå¯åŠ¨**
   - `ekf_filter_node` - EKFèåˆå®šä½

---

## ğŸ›ï¸ å¯åŠ¨å‚æ•°

### è‡ªå®šä¹‰ä¸²å£
```bash
ros2 launch cleanbot_control cleanbot.launch.py port:=/dev/ttyUSB0
```

### è‡ªå®šä¹‰æ³¢ç‰¹ç‡
```bash
ros2 launch cleanbot_control cleanbot.launch.py baudrate:=115200
```

### è‡ªå®šä¹‰Webç«¯å£
```bash
ros2 launch cleanbot_control cleanbot.launch.py web_port:=8081
```

### ç»„åˆå‚æ•°
```bash
ros2 launch cleanbot_control cleanbot.launch.py \
  port:=/dev/ttyUSB0 \
  baudrate:=115200 \
  web_port:=8081
```

---

## âœ… å¯åŠ¨æˆåŠŸæ ‡å¿—

çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—è¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼š

```
[INFO] [robot_state_publisher]: Robot initialized
[INFO] [usb_communication_node]: æˆåŠŸè¿æ¥åˆ° /dev/ttyACM0
[INFO] [usb_communication_node]: USBé€šè®¯èŠ‚ç‚¹å·²å¯åŠ¨
[INFO] [web_control_node]: Webæ§åˆ¶èŠ‚ç‚¹å·²å¯åŠ¨ - HTTPç«¯å£:8080
[INFO] [controller_manager]: Successfully switched controllers!
[INFO] [spawner_diff_drive_controller]: Configured and activated diff_drive_controller
[INFO] [spawner_joint_state_broadcaster]: Configured and activated joint_state_broadcaster
```

---

## ğŸŒ Webç•Œé¢åŠŸèƒ½

### ä¸»è¦åŠŸèƒ½åŒº
1. **å¯¼èˆªåœ°å›¾** - å·¦ä¸Šå¤§åŒºåŸŸ
   - å®æ—¶æœºå™¨äººä½ç½®æ˜¾ç¤º
   - ç‚¹å‡»åœ°å›¾è®¾ç½®ç›®æ ‡ç‚¹
   - è·¯å¾„è§„åˆ’æ˜¾ç¤º
   - æœºå™¨äººæ–¹å‘æŒ‡ç¤º

2. **è¿æ¥çŠ¶æ€** - å³ä¸Š
   - WebSocketè¿æ¥çŠ¶æ€
   - USBä¸²å£è¿æ¥çŠ¶æ€
   - ä¸²å£æ‰«æå’Œè¿æ¥
   - é€šè®¯è´¨é‡ç›‘æµ‹

3. **é€Ÿåº¦æ§åˆ¶** - å³ä¸Šç¬¬äºŒ
   - è™šæ‹Ÿæ‘‡æ†æ§åˆ¶
   - å®æ—¶é€Ÿåº¦æ˜¾ç¤º
   - ç´§æ€¥åœæ­¢æŒ‰é’®

4. **å·¥ä½œæ¨¡å¼** - ä¸­é—´
   - 6ç§å·¥ä½œæ¨¡å¼åˆ‡æ¢
   - å¾…æœº/è‡ªåŠ¨å…¨å±‹/æ²¿è¾¹/å¼“å½¢/é¥æ§/å›å……

5. **æ‰§è¡Œå™¨æ§åˆ¶** - ä¸‹æ–¹
   - å·¦/å³è¾¹åˆ·æ¡£ä½ï¼ˆ0-3ï¼‰
   - é£æœºæ¡£ä½ï¼ˆ0-3ï¼‰
   - æ°´æ³µæ¡£ä½ï¼ˆ0-3ï¼‰

6. **ä¼ æ„Ÿå™¨çŠ¶æ€** - å³ä¸‹
   - ç¢°æ’ä¼ æ„Ÿå™¨ï¼ˆ2ä¸ªï¼‰
   - çº¢å¤–ä¼ æ„Ÿå™¨ï¼ˆ3ä¸ªï¼‰
   - å›å……çŠ¶æ€

7. **å®æ—¶æ•°æ®æ˜¾ç¤º**
   - IMUæ•°æ®ï¼ˆåŠ é€Ÿåº¦ã€è§’é€Ÿåº¦ï¼‰
   - é‡Œç¨‹è®¡æ•°æ®ï¼ˆä½ç½®ã€é€Ÿåº¦ï¼‰
   - è½®é€Ÿæ•°æ®ï¼ˆä½ç½®ã€é€Ÿåº¦ï¼‰

8. **ç³»ç»Ÿæ—¥å¿—** - æœ€ä¸‹æ–¹
   - å®æ—¶æ“ä½œæ—¥å¿—
   - é”™è¯¯ä¿¡æ¯æ˜¾ç¤º

---

## ğŸ“¡ ROS2è¯é¢˜åˆ—è¡¨

### è®¢é˜…çš„è¯é¢˜
```bash
/cmd_vel                    # é€Ÿåº¦å‘½ä»¤ï¼ˆæ¥è‡ªWebæˆ–å¯¼èˆªï¼‰
/control_command            # æ‰§è¡Œå™¨æ§åˆ¶å‘½ä»¤
/scan_connect_port          # ä¸²å£æ‰«æ/è¿æ¥
```

### å‘å¸ƒçš„è¯é¢˜
```bash
/imu/data_raw              # IMUåŸå§‹æ•°æ®
/joint_states              # å…³èŠ‚çŠ¶æ€
/sensors_status            # ä¼ æ„Ÿå™¨çŠ¶æ€
/usb_connected             # USBè¿æ¥çŠ¶æ€
/comm_quality              # é€šè®¯è´¨é‡
/system_status             # ç³»ç»ŸçŠ¶æ€
/diff_drive_controller/odom  # è½®å¼é‡Œç¨‹è®¡
/odometry/filtered         # EKFèåˆé‡Œç¨‹è®¡
/tf                        # TFå˜æ¢
/robot_description         # æœºå™¨äººæè¿°
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### 1. ä¸²å£è¿æ¥å¤±è´¥
**ç°è±¡**ï¼š`Permission denied: '/dev/ttyACM0'`

**è§£å†³**ï¼š
```bash
sudo usermod -a -G dialout $USER
# é‡æ–°ç™»å½•æˆ–é‡å¯
```

### 2. Webç•Œé¢æ— æ³•è®¿é—®
**æ£€æŸ¥**ï¼š
```bash
# æŸ¥çœ‹èŠ‚ç‚¹æ˜¯å¦è¿è¡Œ
ros2 node list | grep web_control_node

# æŸ¥çœ‹æ—¥å¿—
ros2 node info /web_control_node
```

**è§£å†³**ï¼š
- æ£€æŸ¥8080ç«¯å£æ˜¯å¦è¢«å ç”¨
- æ›´æ¢ç«¯å£ï¼š`web_port:=8081`

### 3. ros2_controlå´©æºƒ
**æ£€æŸ¥URDF**ï¼š
```bash
# éªŒè¯URDFæ–‡ä»¶
ros2 topic echo /robot_description --once
```

**ç¡®ä¿**ï¼š
- URDFåŒ…å«`<ros2_control>`æ ‡ç­¾
- ç¡¬ä»¶æ’ä»¶æ­£ç¡®é…ç½®

### 4. æ§åˆ¶å™¨æ— æ³•åŠ è½½
**æ£€æŸ¥**ï¼š
```bash
# åˆ—å‡ºå¯ç”¨æ§åˆ¶å™¨
ros2 control list_controllers

# æ£€æŸ¥ç¡¬ä»¶ç»„ä»¶
ros2 control list_hardware_components
```

### 5. å‰ç«¯æ— æ•°æ®æ˜¾ç¤º
**æ£€æŸ¥WebSocket**ï¼š
- æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
- æŸ¥çœ‹Consoleæ ‡ç­¾é¡µ
- æ£€æŸ¥WebSocketè¿æ¥çŠ¶æ€

**æ£€æŸ¥è¯é¢˜**ï¼š
```bash
# æŸ¥çœ‹è¯é¢˜åˆ—è¡¨
ros2 topic list

# æŸ¥çœ‹IMUæ•°æ®
ros2 topic echo /imu/data_raw --once

# æŸ¥çœ‹å…³èŠ‚çŠ¶æ€
ros2 topic echo /joint_states --once
```

### 6. EKFè­¦å‘Š
**TF_OLD_DATAè­¦å‘Š**æ˜¯æ­£å¸¸çš„ï¼Œè¡¨ç¤ºTFæ•°æ®æ—¶é—´æˆ³ä¸å®Œå…¨åŒæ­¥ã€‚

å¦‚æœæŒç»­å‡ºç°ï¼Œæ£€æŸ¥ï¼š
```bash
# æŸ¥çœ‹TFæ ‘
ros2 run tf2_tools view_frames

# æ£€æŸ¥TFå˜æ¢
ros2 run tf2_ros tf2_echo base_footprint left_wheel_link
```

---

## ğŸ›‘ åœæ­¢ç³»ç»Ÿ

### æ–¹æ³•1ï¼šCtrl+C
åœ¨ç»ˆç«¯æŒ‰ `Ctrl+C` åœæ­¢æ‰€æœ‰èŠ‚ç‚¹

### æ–¹æ³•2ï¼šå•ç‹¬åœæ­¢èŠ‚ç‚¹
```bash
ros2 lifecycle set /node_name shutdown
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€
```bash
ros2 node list
```

### æŸ¥çœ‹è¯é¢˜é¢‘ç‡
```bash
ros2 topic hz /imu/data_raw
ros2 topic hz /joint_states
```

### æŸ¥çœ‹CPUå ç”¨
```bash
top -p $(pgrep -f ros2)
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### é›†æˆNavigation2
```bash
# å®‰è£…nav2
sudo apt install ros-jazzy-navigation2 ros-jazzy-nav2-bringup

# é…ç½®nav2å‚æ•°
# åˆ›å»ºnav2é…ç½®æ–‡ä»¶
# å¯åŠ¨å¯¼èˆªæ ˆ
```

### SLAMåœ°å›¾æ„å»º
```bash
# å®‰è£…slam_toolbox
sudo apt install ros-jazzy-slam-toolbox

# å¯åŠ¨SLAM
ros2 launch slam_toolbox online_async_launch.py
```

---

## ğŸ“ é…ç½®æ–‡ä»¶ä½ç½®

```
config/
â”œâ”€â”€ cleanbot_controllers.yaml     # ros2_controlæ§åˆ¶å™¨é…ç½®
â”œâ”€â”€ ekf.yaml                      # EKFå®šä½å‚æ•°
â”œâ”€â”€ cleanbot_real.urdf.xacro      # æœºå™¨äººURDFæè¿°
â””â”€â”€ cleanbot_real.ros2_control.xacro  # ros2_controlç¡¬ä»¶é…ç½®
```

---

## ğŸ†˜ è·å–å¸®åŠ©

### æŸ¥çœ‹æ—¥å¿—
```bash
# æœ€æ–°æ—¥å¿—ç›®å½•
ls -lt ~/.ros/log/ | head -2

# æŸ¥çœ‹ç‰¹å®šèŠ‚ç‚¹æ—¥å¿—
ros2 run rqt_console rqt_console
```

### æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
```bash
# è¿è¡Œè¯Šæ–­
ros2 run diagnostics_updater diagnostic_aggregator_node

# æŸ¥çœ‹TFæ ‘
ros2 run tf2_tools view_frames
```

---

**ç³»ç»Ÿå°±ç»ªï¼å¼€å§‹ä½¿ç”¨å§ï¼** ğŸ‰

